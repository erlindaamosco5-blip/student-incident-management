<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard | SWDSMS</title>
<style>
/* ===== BODY ===== */
body {  
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(to bottom,  #006400);
  margin: 0;
  padding: 0;
  color:black;
}
a { text-decoration: none; }

/* ===== NAVBAR ===== */
header {
  background-color: #006400;
  border-bottom: 4px solid #FFD700;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.nav-container {
  max-width: 1200px;
  margin: auto;
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 22px;
  font-weight: bold;
  color: #FFD700;
}

.logo img {
  height: 50px;
  width: 50px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #FFD700;
}

nav ul {
  list-style: none;
  display: flex;
  gap: 12px;
  margin: 0;
  padding: 0;
}

nav ul li a {
  color: white;
  text-decoration: none;
  padding: 10px 16px;
  font-weight: 600;
  border-radius: 6px;
  transition: 0.3s;
}

nav ul li a:hover,
nav ul li a.active {
  background-color: #228B22;
  color: #FFD700;
}

/* Mobile Menu Toggle */
.menu-toggle {
  display: none;
  font-size: 26px;
  color: white;
  cursor: pointer;
}

@media (max-width:768px){
  nav ul {
    position: absolute;
    top: 65px;
    right: 0;
    width: 100%;
    background-color: #006400;
    flex-direction: column;
    text-align: center;
    display: none;
  }
  nav ul.show { display: flex; }
  .menu-toggle { display: block; }
}

/* ===== CONTAINER ===== */
.container {
  width: 95%;
  max-width: 1000px;
  margin: 40px auto;
  background: #fff;
  padding: 35px 25px;
  border-radius: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.25);
  border-top: 10px solid #FFD700;
}

h1, h2, h3 {
  color: #FFD700;
  text-align: center;
  margin-bottom: 15px;
}

.subtitle {
  text-align: center;
  color: #006400;
  margin-bottom: 30px;
}

form input,
form select,
form textarea,
form button {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border-radius: 8px;
  border: 1px solid #ebbe0b;
  font-size: 14px;
  box-sizing: border-box;
  transition: all 0.2s ease;
}

form input:focus,
form select:focus,
form textarea:focus {
  outline: none;
  border-color: #c7b136;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
}

form button {
  background-color: #FFD700;
  color: #000;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

form button:hover {
  background-color: #006400;
  color: #fff;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
table th, table td {
  padding: 10px;
  border: 1px solid #000;
} 
table th { 
  background-color: #228B22;
  color: #FFD700;
}

h3#reportsToggle {
  cursor: pointer;
  user-select: none;
  margin-top: 15px;
}

/* ===== FOOTER ===== */
footer {
  text-align: center;
  padding: 20px;
  color: #FFD700;
  margin-top: 10px;
}
</style>
</head>
<body>

<!-- NAVBAR -->
<header>
  <div class="nav-container">
    <div class="logo">
      <img src="logo.png" alt="School Logo"> SWDSMS
    </div>
    <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
    <nav>
      <ul id="navMenu">
        <li><a href="Home.html">Bullying</a></li>
        <li><a href="cyber.html">Cyberbullying</a></li>
        <li><a href="prevention.html">Prevention</a></li>
        <li><a href="report.html">Report</a></li>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="get.html">Get Help Now</a></li>
        <li><a href="#" onclick="logout()">Logout</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- INCIDENT REPORT FORM (Hidden for Admins) -->
<div class="container" id="formContainer" style="display:none;">
  <h1>Anonymous Incident Reporting</h1>
  <p class="subtitle">Submit a report safely and anonymously.</p>

  <form id="incidentForm">
    <input type="text" id="studentName" placeholder="Student Name (Optional)">
    <input type="text" id="grade" placeholder="Grade / Section">
    <select id="incidentType">
      <option>Bullying</option>
      <option>Language</option>
      <option>Digital Misuse</option>
      <option>Cutting Class</option>
      <option>Substance Abuse</option>
      <option>Other Incidents</option>
    </select>
    <textarea id="description" rows="4" placeholder="Describe the incident"></textarea>
    <input type="date" id="date">
    <input type="time" id="time">
    <button type="submit">Submit Report</button>
  </form>

  <div id="successMessage" style="display:none; text-align:center; color:green; font-weight:bold;">
    Report successfully submitted!
  </div>
</div>

<!-- ADMIN VERIFICATION BUTTON FOR TEACHER/PARENT -->
<div class="container" id="verifyAdminContainer" style="display:none; text-align:center;">
  <h3>Become Verified Admin</h3>
  <p class="subtitle">If you are a teacher or parent, click below to verify as admin.</p>
  <button id="verifyAdminBtn" style="background-color:#FFD700; padding:12px 20px; border:none; border-radius:12px; font-weight:bold; cursor:pointer;">Verify as Admin</button>
  <div id="verifyMessage" style="margin-top:10px; font-weight:bold; color:green; display:none;">You are now a verified admin!</div>
</div>

<!-- REPORTS FOR ADMIN -->
<div class="container" id="adminReports" style="display:none;">
  <h3 id="reportsToggle" onclick="toggleReports()">ðŸ“‹ View Submitted Reports</h3>
  <div id="reportsContent" style="display:none; margin-top:10px;">
    <input type="text" id="searchInput" placeholder="Search by student name..." 
      style="width:100%; padding:8px; margin-bottom:10px; border-radius:6px; border:1px solid black;">
    <table>
      <thead>
        <tr>
          <th>Student Name</th>
          <th>Grade</th>
          <th>Type</th>
          <th>Description</th>
          <th>Date</th>
          <th>Time</th>
          <th>Reporter</th>
        </tr>
      </thead>
      <tbody id="reportTable"></tbody>
    </table>
    <div style="margin-top:15px;">
      <strong>Total Incidents Submitted:</strong>
      <span id="totalIncidents">0</span>
    </div>
  </div>
</div>

<!-- SYSTEM USERS FOR ADMIN -->
<div class="container" id="userContainer" style="display:none;">
  <h3>System Users</h3>
  <table>
    <thead>
      <tr>
        <th>Full Name</th>
        <th>Gmail</th>
        <th>Password</th>
        <th>Role</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="usersTable"></tbody>
  </table>
</div>

<footer>Â© 2026 Bullying Awareness Campaign</footer>

<script>
// ===== LOGIN CHECK =====
const loggedUser = JSON.parse(localStorage.getItem("loggedUser"));
if(!loggedUser){
  alert("You must log in first to submit a report.");
  window.location.href = "login.html";
}

// ===== ADMIN CHECK =====
let isAdmin = loggedUser && (loggedUser.email === "erlindaamosco810@gmail.com" || loggedUser.verifiedAdmin);

// ===== SHOW FORM FOR NON-ADMIN USERS =====
const formContainer = document.getElementById("formContainer");
const verifyAdminContainer = document.getElementById("verifyAdminContainer");
if(!isAdmin){
  formContainer.style.display = "block";
  verifyAdminContainer.style.display = loggedUser.role === "teacher" || loggedUser.role === "parent" ? "block" : "none";
} else {
  formContainer.style.display = "none";
  verifyAdminContainer.style.display = "none";
}

// ===== VERIFY ADMIN BUTTON =====
const verifyBtn = document.getElementById("verifyAdminBtn");
if(verifyBtn){
  verifyBtn.addEventListener("click", ()=>{
    loggedUser.verifiedAdmin = true;
    localStorage.setItem("loggedUser", JSON.stringify(loggedUser));
    document.getElementById("verifyMessage").style.display = "block";
    setTimeout(()=>{ location.reload(); }, 1000);
  });
}

// ===== FORMAT TIME =====
function formatTime(t){
  if(!t) return "-";
  const [h,m] = t.split(":");
  let hour = parseInt(h);
  const ampm = hour >= 12 ? "PM" : "AM";
  hour = hour % 12 || 12;
  return `${hour}:${m} ${ampm}`;
}

// ===== RENDER REPORTS =====
const reportTable = document.getElementById("reportTable");
const totalIncidents = document.getElementById("totalIncidents");
const adminReports = document.getElementById("adminReports");
function renderReports(){
  const reports = JSON.parse(localStorage.getItem("reports")) || [];
  reportTable.innerHTML = "";
  reports.forEach(r=>{
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${r.name}</td>
      <td>${r.grade}</td>
      <td>${r.type}</td>
      <td>${r.desc}</td>
      <td>${r.date}</td>
      <td>${formatTime(r.time)}</td>
      <td>${r.reporter}</td>
    `;
    reportTable.appendChild(row);
  });
  totalIncidents.textContent = reports.length;
}

// ===== ADMIN SECTION =====
if(isAdmin){
  adminReports.style.display = "block";
  document.getElementById("userContainer").style.display = "block";
  renderReports();

  const usersTable = document.getElementById("usersTable");
  const users = JSON.parse(localStorage.getItem("users")) || [];

  function renderUsers(){
    usersTable.innerHTML = "";
    users.forEach((user,index)=>{
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${user.fullName}</td>
        <td>${user.email}</td>
        <td>${user.password}</td>
        <td>${user.role}</td>
        <td><button onclick="toggleBlock(${index})">${user.blocked ? "Unblock" : "Block"}</button></td>
      `;
      usersTable.appendChild(row);
    });
  }

  window.toggleBlock = function(index){
    users[index].blocked = !users[index].blocked;
    localStorage.setItem("users", JSON.stringify(users));
    renderUsers();
  }

  renderUsers();

  const searchInput = document.getElementById("searchInput");
  searchInput.addEventListener("input", function() {
    const filter = this.value.toLowerCase();
    const rows = reportTable.getElementsByTagName("tr");
    Array.from(rows).forEach(row => {
      const studentName = row.cells[0].textContent.toLowerCase();
      row.style.display = studentName.includes(filter) ? "" : "none";
    });
  });
}

// ===== SUBMIT REPORT =====
const form = document.getElementById("incidentForm");
const successMessage = document.getElementById("successMessage");
if(form){ 
  form.addEventListener("submit", e=>{
    e.preventDefault();
    const report = {
      name: document.getElementById("studentName").value || "Anonymous",
      grade: document.getElementById("grade").value || "-",
      type: document.getElementById("incidentType").value,
      desc: document.getElementById("description").value,
      date: document.getElementById("date").value,
      time: document.getElementById("time").value,
      reporter: loggedUser.email
    };
    const reports = JSON.parse(localStorage.getItem("reports")) || [];
    reports.push(report);
    localStorage.setItem("reports", JSON.stringify(reports));
    successMessage.style.display = "block";
    setTimeout(()=> successMessage.style.display="none",3000);
    form.reset();
  });
}

// ===== TOGGLE REPORTS =====
function toggleReports(){
  const content = document.getElementById("reportsContent");
  content.style.display = content.style.display === "none" ? "block" : "none";
}

// ===== LOGOUT FUNCTION =====
function logout() {
  localStorage.removeItem("loggedUser");
  alert("You have been logged out.");
  window.location.href = "login.html";
}

// ===== MOBILE MENU =====
function toggleMenu(){
  document.getElementById("navMenu").classList.toggle("show");
}
</script>
</body>
</html>
